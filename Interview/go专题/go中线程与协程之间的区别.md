# 协程

go的协程是依赖于线程的

## 协程的特点

1. 多个协程可有一个或多个线程管理，协程的调度发生在其所在的线程中。
2. 可以被调度，调度策略由应用层代码定义，即可被高度自定义实现。
3. 执行效率高
4. 占用内存少
5. 在执行协程过程中，可以随时中断，去执行另外一个协程，

协程A和协程B的运行像是线程的切换，但是请注意，这里的A和B都运行在同一个线程里面。他们的调度不是线程的切换，而是**纯应用态的协程调度**，性能得到了极大的提升。

### Go的协程调度机制

如果不设置`runtime.GOMAXPROCS()`,程序将会根据操作系统的`CPU`核数而启动对应数量的P，导致多个M，即线程的启动。那么我们程序中的协程 ，就会被`分配到不同的线程`里面去了

### 协程特点为什么执行效率高，占用内存少

因为协程的调度切换不是线程切换，而是由程序自身控制，因此，没有线程切换的开销，和多线程比，线程越多，协程的性能优势就越明显，调度发生在应用态，而非内核态。

```md
内存的花销，使用其所在的线程的内存，意味着线程的内存可以供多个协程适用。
```

协程的调度不需要多线程的锁机制，因为只有一个线程，也`不存在同时写变量冲突`，所以执行效率比多线程高得多。
